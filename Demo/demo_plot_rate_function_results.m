%% Demo that plots data generated by  demo_rate_function.m, which must be run first.
%% Written by Alex Casti, Alex Casti, FDU Department of Mathematics

path(path,'..');

%% Plot the rate function underneath the raster plot of the lab data
t = dataA.t;
rategrid = [];          % If non-empty you can plot horizontal lines in the rate plot (optional)
trange_zoom = [4 4.2];  % Make a second plot that zooms in on the specified time axis
fprintf('\nMaking a raster/rate plot...\n');
plot_raster_and_rate_function(Mspikes,t,rate,rategrid,trange_zoom);

%% Partitioned time B ISI data
% The following function call will generate a data structure 'ISIdata' that contains information
%  about the partitioning of time B events.  The idea is to get a feel for how well the time B
%  transformation achieved homogeneous unit-rate Poisson statistics.  If it did its job well, then
%  time B intervals should have a unit rate exponential distribution, independent of the lab time 
%  firing rate.  We partition the time B intervals into 21 equal subsets.  Within each subset, the
%  range of firing rates and firing rate derivatives are different (i.e. low, medium, high...).  
%  Currently, we partition into 7 subsets along the rate axis and 3 along the rate derivative axis,
%  making for a total of 21 subsets.  Histograms of these 21 subsets of time B intervals should 
%  look approximately exponential, and approximately the same, depending on how close the neuron is
%  to a "perfect copier".  

makeplots = false;
scaleOption = false;
ISIdata = isi_partition_showrate(Mspikes,dataB.MB,Mrate,Mdrate,makeplots,scaleOption); % only generates ISIdata struct
% Now turn on the 'makeplots' flag to show the plots.  The first plot will be a scatter plot of
%  all the spike events in the rate vs drate/dt plane.  The second plot will show the array of 21 
%  time B histograms.  The little number in each box shows the mean rate (lab time) associated 
%  with each subset of data.  This second plot will ask the user to scale the axes, if he so wishes.

makeplots = true;
scaleOption = false;  % choose reasonable axes for all ISI time B histograms (do not prompt user)
ISIdata = isi_partition_showrate(Mspikes,dataB.MB,Mrate,Mdrate,makeplots,scaleOption);